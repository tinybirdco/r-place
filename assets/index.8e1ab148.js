const A=function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const d of s.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function e(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerpolicy&&(s.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?s.credentials="include":n.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(n){if(n.ep)return;n.ep=!0;const s=e(n);fetch(n.href,s)}};A();const b="p.eyJ1IjogIjM0YmRiNTJkLTRiYjYtNDljZi04ZjdjLWI4MmM3MjVmNjRmNSIsICJpZCI6ICJiYzYwZjYzOC1lYzAwLTQxYTgtODhkNS05ZmNhZmNhNmI0MDUifQ.BBKGRtAlvq_cFP-anEaaYi6WSViUWQuVAvB_kSY4qig",w="https://api.tinybird.co",x=1e3,y=500,i=document.getElementById("board"),a=i.getContext("2d"),k=document.getElementById("colorpicker"),f=document.getElementById("datepicker"),h=document.getElementById("remove-datepicker");let l=[],g=!1,c=!0;const I=function({x:t,y:o,color:e}){a.beginPath(),a.fillStyle=e,a.fillRect(t,o,1,1),a.fill()},p=function({dateStart:t,dateEnd:o}={}){const e=t?`?start_date=${t}`:o?`?historic_date=${o}`:"";fetch(`${w}/v0/pipes/get_snapshot.json${e}`,{method:"GET",headers:new Headers({Authorization:`Bearer ${b}`,Accept:"application/json","Content-Type":"application/json"})}).then(function(r){return r.json()}).then(function({data:r}){r.forEach(function(n){I(n)})})},E=function(t){const o=t.map(e=>({...e,date:v()})).reduce((e,r)=>`${e}
${JSON.stringify(r)}`,"");fetch(`${w}/v0/events?name=pixels_table`,{method:"POST",headers:new Headers({Authorization:`Bearer ${b}`,Accept:"application/json","Content-Type":"application/json"}),body:o})},M=function(){i.width=x,i.height=y,i.style.width=`${x}px`,i.style.height=`${y}px`,p()},Y=function(t,o){let e=t.getBoundingClientRect();return{x:Math.floor(o.clientX-e.left),y:Math.floor(o.clientY-e.top),color:k.value}},v=function(t=0){const e=u=>u<10?`0${u}`:u,r=new Date(Date.now()-t*1e3),n=e(r.getUTCDate()),s=e(r.getUTCMonth()+1),d=e(r.getUTCFullYear()),$=e(r.getUTCHours()),S=e(r.getUTCMinutes()),j=e(r.getUTCSeconds()),B=`${d}-${s}-${n}`,N=`${$}:${S}:${j}`;return`${B} ${N}`},C=function(t){g=!0,m(t)},T=function(){g=!1,E(l),l=[]},m=function(t){if(g){const o=Y(i,t);l.find(e=>o.x===e.x&&o.y===e.y)||l.push(o),I(o)}};i.onmousedown=c?C:()=>{};i.ontouchstart=c?C:()=>{};i.ontouchmove=c?m:()=>{};i.onmousemove=c?m:()=>{};i.ontouchend=c?T:()=>{};i.onmouseup=c?T:()=>{};window.setInterval(function(){c&&p({dateStart:v(5)})},2e3);k.oninput=function(){const t=document.getElementById("color-box");t.style.backgroundColor=this.value};f.oninput=function(){h.style="display: inline",i.style="cursor: not-allowed",c=!1,a.clearRect(0,0,i.width,i.height);const t=f.value;p({dateEnd:t.replace("T"," ").concat(":00")})};h.onclick=function(){h.style="display: none",i.style="cursor: crosshair",c=!0,f.value=null,a.clearRect(0,0,i.width,i.height),p({})};M();
